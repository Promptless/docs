---
import { getCollection } from 'astro:content';
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro';

const posts = (await getCollection('blog', ({ data }) => !data.hidden)).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);

const dateFormatter = new Intl.DateTimeFormat('en-US', {
  month: 'short',
  day: 'numeric',
  year: 'numeric',
  timeZone: 'UTC',
});
const getSectionLabel = (section?: string) => section || 'Other';
---

<StarlightPage
  hasSidebar={false}
  frontmatter={{
    title: 'Blog',
    description: 'Product updates, customer stories, and technical insights from Promptless.',
    template: 'doc',
    tableOfContents: false,
    editUrl: false,
  }}
>
  {
    posts.length ? (
      <ul class="collection-feed" role="list">
        {posts.map((entry) => (
          <li>
            <article class="collection-feed-item">
              <div class="collection-feed-meta">
                <p class="collection-feed-date">{dateFormatter.format(entry.data.date)}</p>
                <ul class="collection-tag-list" role="list">
                  <li>
                    <span class="collection-tag">{getSectionLabel(entry.data.section)}</span>
                  </li>
                </ul>
              </div>
              <h2 class="collection-feed-title">
                <a href={`/blog/${entry.slug}`}>{entry.data.title}</a>
              </h2>
              {(entry.data.description || entry.data.subtitle) && (
                <p class="collection-feed-description">{entry.data.description || entry.data.subtitle}</p>
              )}
            </article>
          </li>
        ))}
      </ul>
    ) : (
      <p class="collection-feed-empty">No blog posts yet.</p>
    )
  }
</StarlightPage>
